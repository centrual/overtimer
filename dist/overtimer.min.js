"use strict";function Overtimer(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=null,s={duration:1e3,poll:50,delay:0,repeat:1,debug:!0,start:!0,overtimeLimit:0,overtimeBump:0};this.eventHandlers={start:[],tick:[],stop:[],pause:[],resume:[],delaystart:[],delayend:[],bump:[],repeat:[],finish:[],update:[],poll:[]},"object"===(void 0===e?"undefined":_typeof(e))?this.options=Object.assign({},s,e):("function"==typeof e&&(r=e),this.options=Object.assign({},s)),"function"==typeof i&&(r=i),"number"!=typeof t?(this.log("Duration must be number value.",1e3),this.options.duration=1e3):t<=0?(this.log("Duration must be bigger than 0.",1001),this.options.duration=1e3):this.options.duration=t,this.version="0.1.2",this.globalTimerId=null,this.state=Overtimer.STATES.CREATED,this.createdAt=Date.now(),this.startedAt=-1,this.delayStartedAt=-1,this.delayEndedAt=-1,this.repeatedAt=-1,this.tickedAt=-1,this.stoppedAt=-1,this.finishedAt=-1,this.pausedAt=-1,this.resumedAt=-1,this.bumpedAt=-1,this.pausedTime=-1,this.delayedTime=-1,this.overTime=-1,this.elapsedTime=-1,this.remainingTime=-1,this.totalDelayedTime=-1,this.totalElapsedTime=-1,this.totalRemainingTime=-1,this.currentRepeat=-1,this.timesUpdatedAt=-1,this.lastPollAt=-1,"function"==typeof r&&this.on("finish",r),this.options.start&&this.start()}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Overtimer.STATES={CREATED:0,WAITING:1,RUNNING:2,PAUSED:3,STOPPED:4},Overtimer.global={callbacks:[],timer:null,updateMs:1,lastId:0,join:function join(t){var e=Overtimer.global.callbacks.find(function(e){return e.callback===t});return void 0!==e?e.id:(Overtimer.global.lastId+=1,Overtimer.global.callbacks.push({callback:t,id:Overtimer.global.lastId}),null===Overtimer.global.timer&&(Overtimer.global.timer=setInterval(Overtimer.global.tick,Overtimer.global.updateMs)),Overtimer.global.lastId)},leave:function leave(t){Overtimer.global.callbacks=Overtimer.global.callbacks.filter(function(e){return e.id!==t}),0===Overtimer.global.callbacks.length&&null!==Overtimer.global.timer&&(clearInterval(Overtimer.global.timer),Overtimer.global.timer=null)},tick:function tick(){Overtimer.global.callbacks.forEach(function(t){t.callback()})}},Overtimer.prototype.log=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexcepted error.",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.options.debug&&console.log((-1!==e?"( "+e.toString()+" ): ":"")+" "+t)},Overtimer.prototype.on=function(t,e){return"string"!=typeof t?(this.log("Event name must be string.",1e3),!1):t.length<1?(this.log("Event name length be bigger than 0.",1001),!1):void 0===this.eventHandlers[t]?(this.log("Event name not registered!",1002),!1):"function"!=typeof e?(this.log("Callback is not function!",1003),!1):(this.eventHandlers[t].push(e),!0)},Overtimer.prototype.off=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"string"!=typeof t?(this.log("Event name must be string.",1004),!1):t.length<1?(this.log("Event name length be bigger than 0.",1005),!1):void 0===this.eventHandlers[t]?(this.log("Event name not registered!",1006),!1):(this.eventHandlers[t]="function"==typeof e?this.eventHandlers[t].filter(function(t){return t!==e}):[],!0)},Overtimer.prototype.trigger=function(t){for(var e=this,i=arguments.length,r=Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];return"string"!=typeof t?(this.log("Event name must be string.",1006),!1):t.length<1?(this.log("Event name's length must bigger than 1.",1007),!1):void 0!==this.eventHandlers[t.toLowerCase()]&&Array.isArray(this.eventHandlers[t.toLowerCase()])?(this.eventHandlers[t.toLowerCase()].forEach(function(t){t.call.apply(t,[e].concat(r))}),!0):(this.log("Event not found in list.",1008),!1)},Overtimer.prototype.joinToMainInterval=function(){this.globalTimerId=Overtimer.global.join(this.tickMainInterval.bind(this))},Overtimer.prototype.tickMainInterval=function(){var t=Date.now(),e=t-this.timesUpdatedAt;this.state===Overtimer.STATES.RUNNING?(this.elapsedTime+=e,this.remainingTime-=e,this.totalElapsedTime+=e,this.totalRemainingTime-=e):this.state===Overtimer.STATES.PAUSED?this.pausedTime+=e:this.state===Overtimer.STATES.WAITING&&(this.delayedTime+=e,this.totalDelayedTime+=e,this.delayedTime>=this.options.delay&&this.endDelay()),this.timesUpdatedAt=t,this.trigger("update"),this.lastPollAt+this.options.poll<Date.now()&&(this.trigger("poll"),this.lastPollAt=Date.now()),this.remainingTime<1&&this.tick()},Overtimer.prototype.leaveFromMainInterval=function(){Overtimer.global.leave(this.globalTimerId),this.globalTimerId=null},Overtimer.prototype.bump=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(this.state===Overtimer.STATES.STOPPED||this.state===Overtimer.STATES.CREATED)return this.log("Can't use overtime bump on stopped or created state."),!1;if("number"!=typeof this.options.overtimeLimit||this.options.overtimeLimit<=0)return this.log("Can't use overtime bump when overtime limit below 0."),!1;var e="number"==typeof t&&t>0?t:this.options.overtimeBump;if("number"!=typeof e||e<=0)return this.log("Bump value is not valid! Must be number and bigger than 0 for bump:"),this.log(e),!1;var i=this.options.overtimeLimit-this.remainingTime;return i<0?(this.log("Timer not reached the overtime limit yet."),!1):(e<i?(this.remainingTime+=e,this.totalRemainingTime+=e,this.overTime+=e,this.trigger("bump",e,this.remainingTime)):(this.remainingTime+=i,this.totalRemainingTime+=i,this.overTime+=i,this.trigger("bump",i,this.remainingTime)),this.bumpedAt=Date.now(),!0)},Overtimer.prototype.start=function(){return this.state===Overtimer.STATES.RUNNING||this.state===Overtimer.STATES.WAITING?(this.log("Timer is already started.",1010),!1):(this.options.delay>0?(this.state=Overtimer.STATES.WAITING,this.delayedTime=0,this.totalDelayedTime=0,this.delayStartedAt=Date.now()):this.state=Overtimer.STATES.RUNNING,this.startedAt=Date.now(),this.elapsedTime=0,this.totalElapsedTime=0,this.overTime=0,this.remainingTime=this.options.duration,this.totalRemainingTime=this.options.duration*this.options.repeat,this.currentRepeat=1,this.timesUpdatedAt=Date.now(),this.lastPollAt=Date.now(),this.joinToMainInterval(),this.trigger("start"),this.options.delay>0&&this.trigger("delaystart"),!0)},Overtimer.prototype.pause=function(){return this.state!==Overtimer.STATES.RUNNING&&this.state!==Overtimer.STATES.WAITING?(this.log("Can't pause when timer not running.",1020),!1):(this.state=Overtimer.STATES.PAUSED,this.pausedAt=Date.now(),!0)},Overtimer.prototype.endDelay=function(){return this.state!==Overtimer.STATES.WAITING?(this.log("Can't end delay when timer not waiting.",1023),!1):(this.delayEndedAt=Date.now(),this.state=Overtimer.STATES.RUNNING,this.trigger("delayend"),!0)},Overtimer.prototype.resume=function(){return this.state!==Overtimer.STATES.PAUSED?(this.log("Can't resume when timer not paused.",1021),!1):(this.options.delay>0&&this.delayedTime<this.options.delay?this.state=Overtimer.STATES.WAITING:this.state=Overtimer.STATES.RUNNING,this.resumedAt=Date.now(),!0)},Overtimer.prototype.repeat=function(){return this.state!==Overtimer.STATES.RUNNING&&this.state!==Overtimer.STATES.WAITING?(this.log("Can't repeat when timer not running.",1012),!1):(this.currentRepeat+=1,this.elapsedTime=0,this.remainingTime=this.options.duration,this.repeatedAt=Date.now(),this.totalRemainingTime=this.options.repeat*this.options.duration-(this.currentRepeat-1)*this.options.duration,this.options.delay>0?(this.delayedTime=0,this.state=Overtimer.STATES.WAITING):this.state=Overtimer.STATES.RUNNING,this.timesUpdatedAt=Date.now(),this.trigger("repeat"),this.options.delay>0&&this.trigger("delaystart"),!0)},Overtimer.prototype.tick=function(){this.tickedAt=Date.now(),this.trigger("tick"),this.currentRepeat<this.options.repeat?this.repeat():(this.finishedAt=Date.now(),this.totalRemainingTime=0,this.remainingTime=0,this.stoppedAt=Date.now(),this.trigger("finish"),this.stop())},Overtimer.prototype.stop=function(){return this.state===Overtimer.STATES.STOPPED?(this.log("Timer is already stopped.",1011),!1):(this.leaveFromMainInterval(),this.state=Overtimer.STATES.STOPPED,this.stoppedAt=Date.now(),this.trigger("stop"),!0)},"undefined"!=typeof module&&(module.exports=Overtimer);
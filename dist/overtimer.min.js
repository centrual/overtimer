"use strict";function Overtimer(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=null,n={duration:1e3,repeat:1,debug:!0,start:!0};this.eventHandlers={start:[],tick:[],stop:[],pause:[],resume:[],repeat:[],finish:[],update:[]},"object"===(void 0===e?"undefined":_typeof(e))?this.options=Object.assign({},n,e):("function"==typeof e&&(r=e),this.options=Object.assign({},n)),"function"==typeof i&&(r=i),"number"!=typeof t?(this.log("Duration must be number value.",1e3),this.options.duration=1e3):t<=0&&(this.log("Duration must be bigger than 0.",1001),this.options.duration=1e3),this.version="0.0.3",this.globalTimerId=null,this.state=Overtimer.STATES.CREATED,this.createdAt=Date.now(),this.startedAt=-1,this.repeatedAt=-1,this.tickedAt=-1,this.stoppedAt=-1,this.pausedAt=-1,this.resumedAt=-1,this.pausedTime=-1,this.elapsedTime=-1,this.remainingTime=-1,this.totalElapsedTime=-1,this.totalRemainingTime=-1,this.currentRepeat=-1,this.timesUpdatedAt=-1,"function"==typeof r&&this.on("finish",r),this.options.start&&this.start()}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Overtimer.prototype.log=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexcepted error.",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.options.debug&&console.log((-1!==e?"( "+e.toString()+" ): ":"")+" "+t)},Overtimer.prototype.on=function(t,e){return"string"!=typeof t?(this.log("Event name must be string.",1e3),!1):t.length<1?(this.log("Event name length be bigger than 0.",1001),!1):void 0===this.eventHandlers[t]?(this.log("Event name not registered!",1002),!1):"function"!=typeof e?(this.log("Callback is not function!",1003),!1):(this.eventHandlers[t].push(e),!0)},Overtimer.prototype.off=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"string"!=typeof t?(this.log("Event name must be string.",1004),!1):t.length<1?(this.log("Event name length be bigger than 0.",1005),!1):void 0===this.eventHandlers[t]?(this.log("Event name not registered!",1006),!1):(this.eventHandlers[t]="function"==typeof e?this.eventHandlers[t].filter(function(t){return t!==e}):[],!0)},Overtimer.prototype.trigger=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return"string"!=typeof t?(this.log("Event name must be string.",1006),!1):t.length<1?(this.log("Event name's length must bigger than 1.",1007),!1):void 0!==this.eventHandlers[t.toLowerCase()]&&Array.isArray(this.eventHandlers[t.toLowerCase()])?(void 0===e||Array.isArray(e)?void 0===e&&(this.log("Payload comes undefined.",1009),e=[]):e=[e],this.eventHandlers[t.toLowerCase()].forEach(function(t){t.apply(e)}),!0):(this.log("Event not found in list.",1008),!1)},Overtimer.prototype.joinToMainInterval=function(){this.globalTimerId=Overtimer.global.join(this.tickMainInterval.bind(this))},Overtimer.prototype.tickMainInterval=function(){var t=Date.now(),e=t-this.timesUpdatedAt;this.state===Overtimer.STATES.RUNNING?(this.elapsedTime+=e,this.remainingTime-=e,this.totalElapsedTime+=e,this.totalRemainingTime-=e):this.state===Overtimer.STATES.PAUSED&&(this.pausedTime+=e),this.timesUpdatedAt=t,this.trigger("update"),this.remainingTime<1&&this.tick()},Overtimer.prototype.leaveFromMainInterval=function(){Overtimer.global.leave(this.globalTimerId),this.globalTimerId=null},Overtimer.prototype.start=function(){return this.state===Overtimer.STATES.RUNNING?(this.log("Timer is already started.",1010),!1):(this.state=Overtimer.STATES.RUNNING,this.startedAt=Date.now(),this.elapsedTime=0,this.totalElapsedTime=0,this.remainingTime=this.options.duration,this.totalRemainingTime=this.options.duration*this.options.repeat,this.currentRepeat=1,this.timesUpdatedAt=Date.now(),this.joinToMainInterval(),this.trigger("start"),!0)},Overtimer.prototype.pause=function(){return this.state!==Overtimer.STATES.RUNNING?(this.log("Can't pause when timer not running.",1020),!1):(this.state=Overtimer.STATES.PAUSED,this.pausedAt=Date.now(),!0)},Overtimer.prototype.resume=function(){return this.state!==Overtimer.STATES.PAUSED?(this.log("Can't resume when timer not paused.",1021),!1):(this.state=Overtimer.STATES.RUNNING,this.resumedAt=Date.now(),!0)},Overtimer.prototype.repeat=function(){return this.state!==Overtimer.STATES.RUNNING?(this.log("Can't repeat when timer not running.",1012),!1):(this.currentRepeat+=1,this.elapsedTime=0,this.remainingTime=this.options.duration,this.repeatedAt=Date.now(),this.totalRemainingTime=this.options.repeat*this.options.duration-this.currentRepeat*this.options.duration,this.timesUpdatedAt=Date.now(),this.trigger("repeat"),!0)},Overtimer.prototype.tick=function(){this.tickedAt=Date.now(),this.trigger("tick"),this.currentRepeat<this.options.repeat?this.repeat():(this.trigger("finish"),this.stop())},Overtimer.prototype.stop=function(){return this.state===Overtimer.STATES.STOPPED?(this.log("Timer is already stopped.",1011),!1):(this.leaveFromMainInterval(),this.state=Overtimer.STATES.STOPPED,this.stoppedAt=Date.now(),this.trigger("stop"),!0)},Overtimer.STATES={CREATED:0,RUNNING:1,PAUSED:2,STOPPED:3},Overtimer.global={callbacks:[],timer:null,updateMs:1,lastId:0,join:function join(t){var e=Overtimer.global.callbacks.find(function(e){return e.callback===t});return void 0!==e?e.id:(Overtimer.global.lastId+=1,Overtimer.global.callbacks.push({callback:t,id:Overtimer.global.lastId}),null===Overtimer.global.timer&&(Overtimer.global.timer=setInterval(Overtimer.global.tick,Overtimer.global.updateMs)),Overtimer.global.lastId)},leave:function leave(t){Overtimer.global.callbacks=Overtimer.global.callbacks.filter(function(e){return e.id!==t}),0===Overtimer.global.callbacks.length&&null!==Overtimer.global.timer&&(clearInterval(Overtimer.global.timer),Overtimer.global.timer=null)},tick:function tick(){Overtimer.global.callbacks.forEach(function(t){t.callback()})}},module.exports=Overtimer;